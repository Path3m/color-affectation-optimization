<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="./style.css"/>

    <!-- to draw the streamgraph -->
    <script src="https://d3js.org/d3.v6.js"></script>

    <!-- to print heatmap : note that it can be done with d3, to see later on -->
    <script src="https://cdn.anychart.com/releases/8.11.0/js/anychart-core.min.js"></script>
    <script src="https://cdn.anychart.com/releases/8.11.0/js/anychart-heatmap.min.js"></script>

    <!-- to compute distance between colors -->
    <script src="https://cdn.jsdelivr.net/npm/culori"></script>

    <!-- to use box plot -->
    <script src="https://cdn.plot.ly/plotly-2.32.0.min.js" charset="utf-8"></script>
</head>

<body>
    <nav class="topnav">
        <a href="./index.html">Main Page</a>
        <a class="active" href="./musicStreamgraph.html">Music listening among time</a>
        <a href="./usNamesStreamgraph.html">USA Names among time</a>
    </nav>

    <!-- Part music -->
    <div id="streamgraph1"></div>

    <button id="optimize" onclick="optimizeColor()">Optimize Color</button>
    <button id="random" onclick="randomColor()">Random Color</button>
    <button id="reset" onclick="resetColor()">Reset Color</button>

    <div class="palette-container" id="color-music"></div>
    <div class="heatmap-container" id="dist-bef-opti"></div>
    <div class="heatmap-container" id="dist-aft-opti"></div>


    <div class="heatmap-container" id="heatmapMusic-1"></div>
    <div class="heatmap-container" id="heatmapMusic-2"></div>

    <script type="module">
        import * as obj from "./data/build.js";

        import * as method from "./graph/src/computationMethod.js";
        import {AffectationScore} from "./graph/src/AffectationScore.js";
        import {Permutation} from "./optigen/src/Permutation.js";
        import {ColorPalette} from "./graph/src/ColorPalette.js";

        import {HeatMap} from "./stat/HeatMap.js";

        obj.graphDayMusique.draw(obj.colorMusic.colors, "#streamgraph1");
        obj.colorMusic.draw("color-music", obj.music);

        obj.CDMMusic.draw("dist-bef-opti");
        obj.IMMusic1.draw("heatmapMusic-1");
        obj.IMMusic2.draw("heatmapMusic-2");

        window.optimizeColor = () =>{
            document.getElementById("streamgraph1").innerHTML = "";
            document.getElementById("dist-aft-opti").innerHTML = "";
            document.getElementById("color-music").innerHTML = "";

            let optimisedColors = obj.musicAffect.affectTo(obj.bestGenome);
            //let CDMAfter = HeatMap.colorDistanceHeatMap(obj.colorMusic, obj.music);

            obj.graphDayMusique.svg = "";
            console.log(obj.graphDayMusique);
            obj.graphDayMusique.draw(optimisedColors, "#streamgraph1");
            //CDMAfter.draw("dist-aft-opti");
            new ColorPalette(optimisedColors, undefined).draw("color-music", obj.music);
        }

        window.randomColor = () =>{
            document.getElementById("streamgraph1").innerHTML = "";
            document.getElementById("dist-aft-opti").innerHTML = "";
            document.getElementById("color-music").innerHTML = "";

            let randomColor = Permutation.copyShuffle(obj.colorMusic.colors)
            Permutation.randSwap(Permutation.inplaceShuffle(randomColor));
            //let CDMAfter = HeatMap.colorDistanceHeatMap(obj.colorMusic, obj.music);

            obj.graphDayMusique.svg = "";
            console.log(obj.graphDayMusique);
            obj.graphDayMusique.draw(randomColor, "#streamgraph1");
            //CDMAfter.draw("dist-aft-opti");
            new ColorPalette(randomColor, undefined).draw("color-music", obj.music);
        }

        window.resetColor = () => {
            document.getElementById("streamgraph1").innerHTML = "";
            document.getElementById("dist-aft-opti").innerHTML = "";
            document.getElementById("color-music").innerHTML = "";
            //let CDMAfter = HeatMap.colorDistanceHeatMap(obj.colorMusic, obj.music);

            obj.graphDayMusique.svg = "";
            console.log(obj.graphDayMusique);
            obj.graphDayMusique.draw(obj.colorMusic.colors, "#streamgraph1");
            //CDMAfter.draw("dist-aft-opti");
            new ColorPalette(obj.colorMusic.colors, undefined).draw("color-music", obj.music);
        }
    </script>
</body>

</html>